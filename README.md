# Building Audiveris

Run the build:

    flatpak-builder --force-clean build org.audiveris.audiveris.yml

See [Building your first Flatpak](https://docs.flatpak.org/en/latest/first-build.html)
for additional options to the **flatpak-builder** command.

# Pulling the dependencies and creating the flatpak file

The steps below are only necessary if you want to change the list
of supported languages for the Tesseract OCR engine, or if the Java
dependencies need to be updated. It will always be necessary in the `scripts`
branch, which contains no autogenerated files.

## Selecting languages

Audiveris requires Tesseract "trained data" for different languages to
decode human language. A helper script `languages.sh` is provided to select
languages. For example, to download the data for Italian and French, run

	./languages.sh ita fra

To see a the list of available languages, run:

	./languages.sh list

If the script is started without arguments, it enters "interactive" mode.
Print the list of languages by entering `?`, and enter either the number
or the abbreviation of the language you wish to add. When done selecting,
simply press ENTER to start the download.

Besides downloading the files to the `languages/` subdirectory, the script
also generates suitable YAML for inclusion in the flatpak manifest.

You can now proceed to the "Download Java Dependencies" step, which will
recreate the YAML manifest for audiveris. Or you can manually copy the new
contents of `lang_sources.yml` into

## Downloading Java Dependencies

This is only necessary in order to initialize the git repo for audiveris
and download the gradle package.

### Run build for "dummy.yml"

    flatpak-builder --force-clean --disable-cache --keep-build-dirs dummy dummy.yml

This creates a build directory under `.flatpak-builder/build/dummy`.
If you need to change anything for the subsequent build step, you can
edit files in this directory now. For example, I need to add proxy settings
to `gradle.properties`:

	systemProp.https.proxyHost=192.168.1.5
	systemProp.https.proxyPort=3128

### Run deps.py

Now run

    python3 ./deps.py

This command runs the *audiveris* build in the temporary directory,
copies the downloaded dependecies into the `deps/` subdirectory,
and generates the buildscript `mkgradlerepo.sh` and the list of sources
for the flatpak source file `io.github.Audivervis.audiveris.yml`.

**Important:** Building **audiveris** 5.2.5 and newer requires **JDK 17**.
Make sure that not only the paths to `java` and `javac`, but also the
environment variables `JAVA_HOME` etc. point to the correct SDK.
